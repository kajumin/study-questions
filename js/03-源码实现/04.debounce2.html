<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		#container{
            width: 100%; height: 200px; line-height: 200px; text-align: center; color: #fff; background-color: #444; font-size: 30px;
        }
        html {
        	height: 300%;
        }
	</style>
</head>
<body>
	<div id="container"></div>
	<button id="button">停止防抖</button>
<script type="text/javascript">
	var count = 1;
	var container = document.getElementById('container');

	function getUserAction() {
		console.log('执行一次')
	    container.innerHTML = count++;
	};
	var setUseAction = debounce(getUserAction, 1000,true);
	container.onmousemove = setUseAction;
	document.getElementById("button").addEventListener('click', function(){
    	setUseAction.cancel();
	})
	// 第四版
	function debounce(func, wait, immediate) {
	   
	    var timeout;
	    console.log(immediate)
	    var debounce = function(){
	    	var context = this;
	        var args = arguments;
	        console.log(immediate)
	        if (timeout) clearTimeout(timeout);
	        if (immediate) {
	            // 如果已经执行过，不再执行
	            console.log('第一次执行')
	            var immediate = !timeout;
	            console.log(immediate)
	            timeout = setTimeout(function(){
	                timeout = null;
	            }, wait)
	            if (immediate) func.apply(context, args)
	        }
	        else {
	        	console.log('不是第一次执行')
	            timeout = setTimeout(function(){
	                func.apply(context, args)
	            }, wait);
	        }
	    }
	    debounce.cancel= function(){
	    	clearTimeout(timeout);
        	timeout = null;
	    }
	    return debounce;
	}

	function throttle(fn,delay){

		var lastTime = 0;
		return function() {
			var nowTime = new Date().getTime();
			
			if(nowTime - lastTime > delay) {
				console.log(nowTime)
				fn.apply(this);
				lastTime = nowTime;
			}
		} 
	}
	window.onscroll = throttle(function(){
		console.log('节流 滚屏!')
	},1000);
</script>
</body>
</html>