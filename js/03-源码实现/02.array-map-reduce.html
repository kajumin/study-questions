<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
<script type="text/javascript">
	/*
	forEach map filter some every 都可以指定this
	indexOf lastIndexOf 不可以指定this
	reduce reduceRight 不可以指定this
	兼容性: IE9+
	*/
	Array.prototype.myMap = function(fn, context) {
		var mapArr = []
		for(var i = 0; i < this.length; i++) {
			mapArr.push(fn.call(context, this[i], i, this))
		}
		return mapArr
	}

	var arr = [1,2,3]
	var obj = { name: 'bang' } 
	console.log(arr.myMap(function(val, i, arr){
		console.log(this)
		console.log(val, i)
		return val * 2
	}, obj))
	// console.log(arr.map(function(val, i, arr){
	// 	console.log(this)
	// 	console.log(val, i)
	// 	return val * 2
	// }, obj))

	//1、初始值不传怎么处理
	//2、回调函数的参数有哪些，返回值如何处理。
	Array.prototype.myReduce = function(fn, initialValue) {
		var res = initialValue ? initialValue : this[0] 
		var startIndex = initialValue ? 0 : 1
		for(var i = startIndex; i < this.length; i++) {
			var res = fn.call(null, res, this[i], i, this) 
		}
		return res	
	}
	console.log(arr.myReduce(function(initialValue, prev, i, arr){
		console.log(initialValue, prev, i, arr)
		return initialValue + prev
	}))
	// console.log(arr.reduce(function(initialValue, prev, i, arr){
	// 	console.log(initialValue, prev, i, arr)
	// 	return initialValue + prev
	// }))

	// 可以指定this, 不改变原数组
	Array.prototype.myFilter  = function(fn, context) {

		var filterArr = [];
		for(var i = 0;i < this.length;i ++) {
			fn.call(context, this[i], i, this) && filterArr.push(this[i]);
		}
		return filterArr;
	}
	var filter = arr.myFilter(function(item, index, array){
		// console.log(this)
		return item > 2;
	}, []);
	var filter2 = arr.filter(function(item, index, array){
		// console.log(this)
		return item > 2;
	}, []);
	console.log(filter)
	console.log(filter2)

	// 张鑫旭文章实现的
	if(typeof Array.prototype.some != 'function') {
		Array.prototype.some = function(fn, context) {
			var passed = false
			if(typeof fn == 'function') {
				for(var i = 0; i < this.length; i++) {
					passed = !!fn.call(context, this[i], i, this)
					if(passed) break;
				}
			}
			return passed
		}
	}
	if(typeof Array.prototype.every != 'function') {
		Array.prototype.every = function(fn, context) {
			var passed = true
			if(typeof fn == 'function') {
				for(var i = 0; i < this.length; i++) {
					passed = !!fn.call(context, this[i], i, this)
					if(!passed) break
				}
			}
			return passed
		}
	}

	Array.prototype.myIndexOf = function(searchElement, searchIndex) {

		var index = -1
		searchIndex = searchIndex * 1 || 0
		for(var i = 0; i < this.length; i++) {
			if(i >= searchIndex && searchElement === this[i]) {
				index = i
				break;
			}
		}
		return index
	}

	Array.prototype.myLastIndexOf = function(searchElement, searchIndex) {

		var length = this.length
		var index = -1
		if(searchIndex === 0) {
			searchIndex = 0
		} else {
			searchIndex = searchIndex * 1 || length - 1
		}
		
		for(var i = length - 1; i >= 0; i--) {
			if(i <= searchIndex && searchElement === this[i]) {
				index = i
				break;
			}
		}
		return index
	}

	console.log(arr.myIndexOf(2, 1))
	console.log(arr.myLastIndexOf(3, 1))
	console.log(arr.myLastIndexOf(3, 0))


	
</script>
</body>
</html>