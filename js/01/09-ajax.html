<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<!--
	1.手写ajax  处理url data method success
	2.跨域的几种实现方式
	  -->
<script type="text/javascript">
	function myAjax(opt) {
		opt = opt || {};
		opt.method = opt.method || 'GET';
		opt.url = opt.url || '';
		opt.data = opt.data || null;
		opt.dataType = opt.dataType || 'json';
		// opt.success = opt.success || function () {
  //   	};

    	var params = [];
    	for(var key in opt.data) {
    		params.push(key+ '=' + opt.data[key]);
    	}
    	var paramsData = params.join('&');
		var xhr = null;
		if(XMLHttpRequest) {
			xhr = new XMLHttpRequest();
		}else {
			xhr = new ActiveXObject('Microsoft.XMLHTTP');
		}
		if (opt.dataType === 'JSONP') {
        	creatScript(opt.url, postData);
    	}else if(opt.method.toLowerCase() === 'post'){
    		xhr.open(opt.method,opt.url);
    		xhr.setRequestHeader('Content-Type','application/x-form-urlencoded;charset=uft-8');
    		xhr.send(paramsData);
    	}else {
    		xhr.open(opt.method,opt.url);
    		xhr.send(null);
    	}
		
		xhr.onreadyStateChange = function(){
			
			if(xhr.readyState == 4 && xhr.status == 200) {	
				console.log(xhr)
				console.log(xhr.responseText)	
				data.success && data.success();

			}
		}
	}
	function  creatScript(url,data) {
		var script = document.creatElement('script');
		script.src = url + '?' + data + 'callback=fn';
		document.body.appendChild(script);
	}
	myAjax({
		url:'http://localhost:3000/data'
	});

// 	$.ajax({
// 		url: '1.php',
// 		method: 'post',
// 		data: { action :'add_user'},
// 		dataType: 'json',
// 		traditional: true, 
// 		processData: false, // 将数据转换成对象，不对数据做处理，故 processData: false 
// 		contentType: false,  // 不设置数据类型
// 		'xhrFields': {                
// 　　　　　　withCredentials: true// 这样在请求的时候会自动将浏览器中的cookie发送给后台
// 　　　　},
// 		success(){

// 		},
// 		error(){

// 		},
// 		complete(){

// 		}
// 	})
	
</script>
</body>
</html>