<!DOCTYPE html>
<html>
<head>
	<title>ajax的封装</title>
</head>
<body>
<script>
	// 1.写一个相对比较完善的用例
	// 2.写一个空函数,没有形参,用例放进去
	// 3.根据使用过程中的需求抽象参数

	
    function re(res1){
			return res1
	}
	function ajax(method,url,params){
		method = method.toUpperCase();
		var data = null
		// 将object 类型的参数转换为key1=value1&key2=value2
		if(typeof params === 'object') {
			var temparr = [];
			for(var key in params){
				var value = params[key]
				temparr.push(key + '=' + value)
			}
			// temparr =>['key1=value1','key2=value2']
			params = temparr.join('&')
		}
		console.log(params)
		var xhr = new XMLHttpRequest()
		if(method === 'GET'){
			url +='?'+ params;
		}
		xhr.open(method,url)
		// 注意open要在setRequestHeader之前
		if(method === 'POST'){
			xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
			data = params
		}

		
		xhr.send(data)
		// var result;
		// 不应该在封装的函数中主观的使用返回数据
		xhr.onreadystatechange = function() {
			if(this.readyState !== 4) return
				// result = this.responseText
			// console.log(this.responseText)
			// 无法在内部包含的函数通过return返回结果
			// return this.responseText
			re(this.responseText)
			
		}
		// return result
	}
	var res1=ajax('GET','http://localhost/ajax/time.php','id=1')
	console.log(res1)
	ajax('GET','http://localhost/ajax/time.php',{id:1})
	ajax('POST','http://localhost/ajax/add.php',{key1:'value1',key2:'value2'})

	/*version 3
	function ajax(method,url,params){
		var data = null
		// 将object 类型的参数转换为key1=value1&key2=value2
		if(typeof params === 'object') {
			var temparr = [];
			for(var key in params){
				var value = params[key]
				temparr.push(key + '=' + value)
			}
			// temparr =>['key1=value1','key2=value2']
			params = temparr.join('&')
		}
		console.log(params)
		var xhr = new XMLHttpRequest()
		if(method === 'GET'){
			url +='?'+ params;
		}
		xhr.open(method,url)
		// 注意open要在setRequestHeader之前
		if(method === 'POST'){
			xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
			data = params
		}

		
		xhr.send(data)
		
		xhr.onreadystatechange = function() {
			if(this.readyState !== 4) return

			console.log(this.responseText)
			
		}
	}
	ajax('GET','http://localhost/ajax/time.php','id=1')
	ajax('GET','http://localhost/ajax/time.php',{id:1})
	ajax('POST','http://localhost/ajax/add.php',{key1:'value1',key2:'value2'})
	*/
	/* version 2
	function ajax(method,url,params){
		var data = null
		var xhr = new XMLHttpRequest()
		if(method === 'GET'){
			url +='?'+ params;
		}
		xhr.open(method,url)
		// 注意open要在setRequestHeader之前
		if(method === 'POST'){
			xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
			data = params
		}

		
		xhr.send(data)
		
		xhr.onreadystatechange = function() {
			if(this.readyState !== 4) return

			console.log(this.responseText)
			
		}
	}
	ajax('GET','http://localhost/ajax/time.php','id=1')
	ajax('POST','http://localhost/ajax/add.php','key1=value1&key2=value2')
	*/
	/*version 1
	function ajax(method,url,params){
		var params = params || null;
		var xhr = new XMLHttpRequest()
		xhr.open(method,url)
		if(method === 'POST'){
			xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded')
		}

		xhr.send(params)
		
		xhr.onreadystatechange = function() {
			if(this.readyState !== 4) return

			console.log(this.responseText)
			
		}
	}
	ajax('GET','http://localhost/ajax/time.php')
	ajax('POST','http://localhost/ajax/add.php','key1=value1&key2=value2')*/
</script>
</body>
</html>